---
import type { GetStaticPaths } from "astro";
import { getImage } from "astro:assets";
import PersonInfo from "../../components/personInfo.astro";
import { getSpeakers } from "../../helpers/getSpeakers";
import { supportedSocials } from "../../helpers/supportedSocials";
import Layout from "../../layouts/Layout.astro";

export const getStaticPaths = (async () => {
  const speakers = await getSpeakers();

  return speakers.map((speaker) => ({
    params: {
      speaker: speaker.slug,
    },
    props: { ...speaker },
  }));
}) satisfies GetStaticPaths;

const {
  firstName,
  fullName,
  id,
  isTopSpeaker,
  lastName,
  profilePicture,
  slug,
  tagLine,
  bio,
  links,
  sessions,
} = Astro.props;

const socialLinks: Record<string, string> = {};

links.map((link) => {
  let finalLink = link.linkType.toLowerCase();

  if (finalLink === "blog") {
    finalLink = link.url.includes("medium")
      ? supportedSocials.medium
      : supportedSocials.website;
  }

  socialLinks[finalLink] = link.url;
});

const image = await getImage({ src: profilePicture, height: 500, width: 500 });
---

<Layout>
  <PersonInfo
    socialList={socialLinks}
    name={fullName}
    image={image.src}
    title={tagLine}
    bio={bio}
  />
</Layout>

<style lang="scss"></style>
